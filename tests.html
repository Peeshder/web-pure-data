<html>
<head>
	<link rel="stylesheet" href="style.css" type="text/css" media="screen">
	<script src='pd.js' type='text/javascript'></script>
	<script type='text/javascript'>
		var pd = null;
		function launch() {
			tests = [
				'test-no-such-file',
				'test-0-bad-object',
				'two-bad-objects',
				'loadbang-into-print',
				'loadbang-basic-message-print',
				'test-1-basic-osc',
				'osc-left-only',
				'test-2-mutiply',
				'divide',
				'test-3-add',
				'subtract',
				'test-4-multiply-constant',
				'test-5-phasor',
				'test-6-two-dacs',
				'receive-osc-frequency',
				'receive-alias',
				'osc-no-argument',
				'osc-into-osc',
				'array',
				'tabread',
				//'connection-fanning-in',
			];
			var body = document.getElementsByTagName("body")[0];
			var contents = document.getElementById('contents');
			var buttons = document.getElementById('buttons');
			
			var pdfile = document.location.href.split("?")[1];
			if (pdfile) {
				// add play an pause buttons
				buttons.innerHTML += "<input type='button' value='play' onclick='javascript: pd.play();' /> <input type='button' value='pause' onclick='javascript: pd.stop();' />";
				// information and graphic about this patch
				contents.innerHTML = contents.innerHTML + "<h1>" + pdfile + "</h1><img src='unittests/" + pdfile + ".png'>";
				// create a new pd instance in debug-output mode
				pd = new Pd(44100, 4410, true);
				// Load up the particular patch, and play it when the patch-is-loaded callback fires
				pd.load("unittests/" + pdfile + ".pd", pd.play);
				
				// trigger the load of the interface html (if it exists)
				MakeRequest("unittests/" + pdfile + ".html", {"loadcomplete": function(result, request) {
						if (request.status != 404) {
							document.getElementById("interface").innerHTML = result;
						}
					}
				});
			} else {
				for (t in tests){
					contents.innerHTML = contents.innerHTML + "<span class='test'><a href='?" + tests[t] + "'><p>" + tests[t] + "</p><img src='unittests/" + tests[t] + ".png'></a></span>";
				}
			}
		}
	</script>
</head>
<body onLoad='var l = launch();'>
	<h1>WebPd</h1>
	<p>Copyright Chris McCormick, 2010.</p>
	<p><a href='COPYING'>AGPLv3 Licensed.</a></p>
	<p>You will need Firefox's "Audio Data API" builds from <a href='https://wiki.mozilla.org/Audio_Data_API#Obtaining_Code_and_Builds'>here</a>.</p>
	<div id='contents'></div>
	<div id='interface'></div>
	<div id='buttons'></div>
	<pre id='console'></pre>
</body>
</html>
